"use strict";function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _iterableToArray(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}window.Joomla=window.Joomla||{},window.akeeba=window.akeeba||{},window.akeeba.Passwordless=window.akeeba.Passwordless||{},function(a,b,c){"use strict";var d=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",c="";return Object.keys(a).forEach(function(e){return"object"===_typeof(a[e])?void(c+="".concat(d(a[e],e))):(0<c.length&&(c+="&"),void(c+=""===b?"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(a[e])):"".concat(encodeURIComponent(b),"[").concat(encodeURIComponent(e),"]=").concat(encodeURIComponent(a[e]))))}),c},e=function(b){a.renderMessages({error:[b]}),window.scrollTo({top:0,left:0,behavior:"smooth"})};b.createCredentials=function(f,g){if(!("credentials"in navigator))return void e(a.JText._("PLG_SYSTEM_PASSWORDLESS_ERR_NO_BROWSER_SUPPORT"));var h=c.getElementById(f);if(h){var i=JSON.parse(atob(h.dataset.public_key)),j=a.getOptions("system.paths"),k="".concat(j?"".concat(j.base,"/index.php"):window.location.pathname),l=function(b){return btoa(String.fromCharCode.apply(String,_toConsumableArray(b)))},m=function(a){var b=a.replace(/-/g,"+").replace(/_/g,"/"),c=b.length%4;if(c){if(1===c)throw new Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");b+=Array(5-c).join("=")}return b};i.challenge=Uint8Array.from(window.atob(m(i.challenge)),function(a){return a.charCodeAt(0)}),i.user.id=Uint8Array.from(window.atob(i.user.id),function(a){return a.charCodeAt(0)}),i.excludeCredentials&&(i.excludeCredentials=i.excludeCredentials.map(function(a){return a.id=Uint8Array.from(window.atob(m(a.id)),function(a){return a.charCodeAt(0)}),a})),navigator.credentials.create({publicKey:i}).then(function(f){var h={id:f.id,type:f.type,rawId:l(new Uint8Array(f.rawId)),response:{clientDataJSON:l(new Uint8Array(f.response.clientDataJSON)),attestationObject:l(new Uint8Array(f.response.attestationObject))}},i={option:"com_ajax",group:"system",plugin:"passwordless",format:"raw",akaction:"create",encoding:"raw",data:btoa(JSON.stringify(h))};i[a.getOptions("csrf.token")]=1,a.request({url:k,method:"POST",data:d(i),onSuccess:function onSuccess(a){var d=c.querySelectorAll(g);if(d){var e=d[0];e.outerHTML=a,b.initManagement()}},onError:function onError(a){e("".concat(a.status," ").concat(a.statusText))}})})["catch"](function(a){e(a)})}},b.editLabel=function(b,f){var g=c.getElementById(f);if(!g)return!1;var h=a.getOptions("system.paths"),i="".concat(h?"".concat(h.base,"/index.php"):window.location.pathname),j=b.parentElement.parentElement,k=j.dataset.credential_id,l=j.querySelectorAll("td"),m=l[0],n=l[1],o=n.querySelectorAll("button"),p=o[0],q=o[1],r=m.innerText,s=c.createElement("input");s.type="text",s.name="label",s.defaultValue=r;var t=c.createElement("button");t.className="btn btn-success btn-sm",t.innerText=a.JText._("PLG_SYSTEM_PASSWORDLESS_MANAGE_BTN_SAVE_LABEL"),t.addEventListener("click",function(){var b=s.value;if(""!==b){var c={option:"com_ajax",group:"system",plugin:"passwordless",format:"json",encoding:"json",akaction:"savelabel",credential_id:k,new_label:b};c[a.getOptions("csrf.token")]=1,a.request({url:i,method:"POST",data:d(c),onSuccess:function onSuccess(b){var c=!1;try{c=JSON.parse(b)}catch(a){c="true"===b}!0!==c&&e(a.JText._("PLG_SYSTEM_PASSWORDLESS_ERR_LABEL_NOT_SAVED"))},onError:function onError(b){e("".concat(a.JText._("PLG_SYSTEM_PASSWORDLESS_ERR_LABEL_NOT_SAVED")," -- ").concat(b.status," ").concat(b.statusText))}})}return m.innerText=b,p.disabled=!1,q.disabled=!1,!1},!1);var u=c.createElement("button");return u.className="btn btn-danger btn-sm",u.innerText=a.JText._("PLG_SYSTEM_PASSWORDLESS_MANAGE_BTN_CANCEL_LABEL"),u.addEventListener("click",function(){return m.innerText=r,p.disabled=!1,q.disabled=!1,!1},!1),m.innerHTML="",m.appendChild(s),m.appendChild(t),m.appendChild(u),p.disabled=!0,q.disabled=!0,!1},b["delete"]=function(b,f){var g=c.getElementById(f);if(!g)return!1;var h=a.getOptions("system.paths"),i="".concat(h?"".concat(h.base,"/index.php"):window.location.pathname),j=b.parentElement.parentElement,k=j.dataset.credential_id,l=j.querySelectorAll("td"),m=l[1],n=m.querySelectorAll("button"),o=n[0],p=n[1];o.disabled=!0,p.disabled=!0;var q={option:"com_ajax",group:"system",plugin:"passwordless",format:"json",encoding:"json",akaction:"delete",credential_id:k};return q[a.getOptions("csrf.token")]=1,a.request({url:i,method:"POST",data:d(q),onSuccess:function onSuccess(b){var c=!1;try{c=JSON.parse(b)}catch(a){c="true"===b}return!0===c?void j.parentElement.removeChild(j):void e(a.JText._("PLG_SYSTEM_PASSWORDLESS_ERR_NOT_DELETED"))},onError:function onError(b){o.disabled=!1,p.disabled=!1,e("".concat(a.JText._("PLG_SYSTEM_PASSWORDLESS_ERR_NOT_DELETED")," -- ").concat(b.status," ").concat(b.statusText))}}),!1},b.addOnClick=function(a){return a.preventDefault(),b.createCredentials(a.currentTarget.getAttribute("data-random-id"),"#plg_system_passwordless-management-interface"),!1},b.editOnClick=function(a){return a.preventDefault(),b.editLabel(a.currentTarget,a.currentTarget.getAttribute("data-random-id")),!1},b.deleteOnClick=function(a){return a.preventDefault(),b["delete"](a.currentTarget,a.currentTarget.getAttribute("data-random-id")),!1},b.initManagement=function(){var a=c.getElementById("plg_system_passwordless-manage-add");a&&a.addEventListener("click",b.addOnClick);var d=[].slice.call(c.querySelectorAll(".plg_system_passwordless-manage-edit"));d.length&&d.forEach(function(a){a.addEventListener("click",b.editOnClick)});var e=[].slice.call(c.querySelectorAll(".plg_system_passwordless-manage-delete"));e.length&&e.forEach(function(a){a.addEventListener("click",b.deleteOnClick)})},b.initManagement()}(Joomla,window.akeeba.Passwordless,document);

//# sourceMappingURL=manage.min.js.map