"use strict";function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _iterableToArray(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}window.Joomla=window.Joomla||{},window.akeeba=window.akeeba||{},window.akeeba.Passwordless=window.akeeba.Passwordless||{},function(a,b,c){"use strict";var d=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",c="";return Object.keys(a).forEach(function(e){return"object"===_typeof(a[e])?void(c+="".concat(d(a[e],e))):(0<c.length&&(c+="&"),void(c+=""===b?"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(a[e])):"".concat(encodeURIComponent(b),"[").concat(encodeURIComponent(e),"]=").concat(encodeURIComponent(a[e]))))}),c},e=function(b){a.renderMessages({error:[b]}),window.scrollTo({top:0,left:0,behavior:"smooth"})};b.initCreateCredentials=function(){if(!("credentials"in navigator))return void e(a.Text._("PLG_SYSTEM_PASSWORDLESS_ERR_NO_BROWSER_SUPPORT"));var c=a.getOptions("system.paths"),f="".concat(c?"".concat(c.base,"/index.php"):window.location.pathname),g={option:"com_ajax",group:"system",plugin:"passwordless",format:"json",akaction:"initcreate",encoding:"json"};g[a.getOptions("csrf.token")]=1,a.request({url:f,method:"POST",data:d(g),onSuccess:function onSuccess(c){try{var d=JSON.parse(c);b.createCredentials(d)}catch(b){e(a.Text._("PLG_SYSTEM_PASSWORDLESS_ERR_XHR_INITCREATE"))}},onError:function onError(a){e("".concat(a.status," ").concat(a.statusText))}})},b.createCredentials=function(f){var g=a.getOptions("system.paths"),h="".concat(g?"".concat(g.base,"/index.php"):window.location.pathname),i=function(b){return btoa(String.fromCharCode.apply(String,_toConsumableArray(b)))},j=function(a){var b=a.replace(/-/g,"+").replace(/_/g,"/"),c=b.length%4;if(c){if(1===c)throw new Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");b+=Array(5-c).join("=")}return b};f.challenge=Uint8Array.from(window.atob(j(f.challenge)),function(a){return a.charCodeAt(0)}),f.user.id=Uint8Array.from(window.atob(f.user.id),function(a){return a.charCodeAt(0)}),f.excludeCredentials&&(f.excludeCredentials=f.excludeCredentials.map(function(a){return a.id=Uint8Array.from(window.atob(j(a.id)),function(a){return a.charCodeAt(0)}),a})),console.log(f),navigator.credentials.create({publicKey:f}).then(function(f){var g={id:f.id,type:f.type,rawId:i(new Uint8Array(f.rawId)),response:{clientDataJSON:i(new Uint8Array(f.response.clientDataJSON)),attestationObject:i(new Uint8Array(f.response.attestationObject))}},j={option:"com_ajax",group:"system",plugin:"passwordless",format:"raw",akaction:"create",encoding:"raw",data:btoa(JSON.stringify(g))};j[a.getOptions("csrf.token")]=1,a.request({url:h,method:"POST",data:d(j),onSuccess:function onSuccess(a){var d=c.querySelectorAll("#plg_system_passwordless-management-interface");if(d){var e=d[0];e.outerHTML=a,b.initManagement(),b.reactivateTooltips()}},onError:function onError(a){e("".concat(a.status," ").concat(a.statusText))}})})["catch"](function(a){e(a)})},b.editLabel=function(b){var f=a.getOptions("system.paths"),g="".concat(f?"".concat(f.base,"/index.php"):window.location.pathname),h=b.parentElement.parentElement,i=h.dataset.credential_id,j=h.querySelectorAll(".plg_system_passwordless-cell"),k=j[0],l=j[1],m=l.querySelectorAll("button"),n=m[0],o=m[1],p=k.innerText,q=c.createElement("input");q.type="text",q.name="label",q.defaultValue=p;var r=c.createElement("button");r.className="btn btn-success btn-sm",r.innerText=a.Text._("PLG_SYSTEM_PASSWORDLESS_MANAGE_BTN_SAVE_LABEL"),r.addEventListener("click",function(){var b=q.value;if(""!==b){var c={option:"com_ajax",group:"system",plugin:"passwordless",format:"json",encoding:"json",akaction:"savelabel",credential_id:i,new_label:b};c[a.getOptions("csrf.token")]=1,a.request({url:g,method:"POST",data:d(c),onSuccess:function onSuccess(b){var c=!1;try{c=JSON.parse(b)}catch(a){c="true"===b}!0!==c&&e(a.Text._("PLG_SYSTEM_PASSWORDLESS_ERR_LABEL_NOT_SAVED"))},onError:function onError(b){e("".concat(a.Text._("PLG_SYSTEM_PASSWORDLESS_ERR_LABEL_NOT_SAVED")," -- ").concat(b.status," ").concat(b.statusText))}})}return k.innerText=b,n.disabled=!1,o.disabled=!1,!1},!1);var s=c.createElement("button");return s.className="btn btn-danger btn-sm",s.innerText=a.Text._("PLG_SYSTEM_PASSWORDLESS_MANAGE_BTN_CANCEL_LABEL"),s.addEventListener("click",function(){return k.innerText=p,n.disabled=!1,o.disabled=!1,!1},!1),k.innerHTML="",k.appendChild(q),k.appendChild(r),k.appendChild(s),n.disabled=!0,o.disabled=!0,!1},b["delete"]=function(b){var c=a.getOptions("system.paths"),f="".concat(c?"".concat(c.base,"/index.php"):window.location.pathname),g=b.parentElement.parentElement,h=g.dataset.credential_id,i=g.querySelectorAll(".plg_system_passwordless-cell"),j=i[1],k=j.querySelectorAll("button"),l=k[0],m=k[1];l.disabled=!0,m.disabled=!0;var n={option:"com_ajax",group:"system",plugin:"passwordless",format:"json",encoding:"json",akaction:"delete",credential_id:h};return n[a.getOptions("csrf.token")]=1,a.request({url:f,method:"POST",data:d(n),onSuccess:function onSuccess(b){var c=!1;try{c=JSON.parse(b)}catch(a){c="true"===b}return!0===c?void g.parentElement.removeChild(g):void e(a.Text._("PLG_SYSTEM_PASSWORDLESS_ERR_NOT_DELETED"))},onError:function onError(b){l.disabled=!1,m.disabled=!1,e("".concat(a.Text._("PLG_SYSTEM_PASSWORDLESS_ERR_NOT_DELETED")," -- ").concat(b.status," ").concat(b.statusText))}}),!1},b.reactivateTooltips=function(){var b=a.getOptions("bootstrap.tooltip");"object"===_typeof(b)&&null!==b&&Object.keys(b).forEach(function(a){var d=b[a],e={animation:!d.animation||d.animation,container:!!d.container&&d.container,delay:d.delay?d.delay:0,html:!!d.html&&d.html,selector:!!d.selector&&d.selector,trigger:d.trigger?d.trigger:"hover focus",fallbackPlacement:d.fallbackPlacement?d.fallbackPlacement:null,boundary:d.boundary?d.boundary:"clippingParents",title:d.title?d.title:"",customClass:d.customClass?d.customClass:"",sanitize:!d.sanitize||d.sanitize,sanitizeFn:d.sanitizeFn?d.sanitizeFn:null,popperConfig:d.popperConfig?d.popperConfig:null};d.placement&&(e.placement=d.placement),d.template&&(e.template=d.template),d.allowList&&(e.allowList=d.allowList);var f=Array.from(c.querySelectorAll(a));f.length&&f.map(function(a){return new window.bootstrap.Tooltip(a,e)})})},b.addOnClick=function(a){return a.preventDefault(),b.initCreateCredentials(),!1},b.editOnClick=function(a){return a.preventDefault(),b.editLabel(a.currentTarget),!1},b.deleteOnClick=function(a){return a.preventDefault(),b["delete"](a.currentTarget),!1},b.initManagement=function(){var a=c.getElementById("plg_system_passwordless-manage-add");a&&a.addEventListener("click",b.addOnClick);var d=[].slice.call(c.querySelectorAll(".plg_system_passwordless-manage-edit"));d.length&&d.forEach(function(a){a.addEventListener("click",b.editOnClick)});var e=[].slice.call(c.querySelectorAll(".plg_system_passwordless-manage-delete"));e.length&&e.forEach(function(a){a.addEventListener("click",b.deleteOnClick)})},b.initManagement()}(Joomla,window.akeeba.Passwordless,document);

//# sourceMappingURL=manage.min.js.map