"use strict";function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _iterableToArray(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}window.Joomla=window.Joomla||{},window.akeeba=window.akeeba||{},window.akeeba.Passwordless=window.akeeba.Passwordless||{},function(a,b,c){"use strict";var d=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",c="";return Object.keys(a).forEach(function(e){return"object"===_typeof(a[e])?void(c+="".concat(d(a[e],e))):(0<c.length&&(c+="&"),void(c+=""===b?"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(a[e])):"".concat(encodeURIComponent(b),"[").concat(encodeURIComponent(e),"]=").concat(encodeURIComponent(a[e]))))}),c},e=function(b){a.renderMessages({error:[b]}),window.scrollTo({top:0,left:0,behavior:"smooth"})};b.createCredentials=function(f,g){if(!("credentials"in navigator))return void e(a.JText._("PLG_SYSTEM_PASSWORDLESS_ERR_NO_BROWSER_SUPPORT"));var h=c.getElementById(f);if(h){var i=JSON.parse(atob(h.dataset.public_key)),j=atob(h.dataset.postback_url),k=function(b){return btoa(String.fromCharCode.apply(String,_toConsumableArray(b)))},l=function(a){var b=a.replace(/-/g,"+").replace(/_/g,"/"),c=b.length%4;if(c){if(1===c)throw new Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");b+=Array(5-c).join("=")}return b};i.challenge=Uint8Array.from(window.atob(l(i.challenge)),function(a){return a.charCodeAt(0)}),i.user.id=Uint8Array.from(window.atob(i.user.id),function(a){return a.charCodeAt(0)}),i.excludeCredentials&&(i.excludeCredentials=i.excludeCredentials.map(function(a){return a.id=Uint8Array.from(window.atob(l(a.id)),function(a){return a.charCodeAt(0)}),a})),console.log(i),navigator.credentials.create({publicKey:i}).then(function(f){var h={id:f.id,type:f.type,rawId:k(new Uint8Array(f.rawId)),response:{clientDataJSON:k(new Uint8Array(f.response.clientDataJSON)),attestationObject:k(new Uint8Array(f.response.attestationObject))}},i={option:"com_ajax",group:"system",plugin:"passwordless",format:"raw",akaction:"create",encoding:"raw",data:btoa(JSON.stringify(h))};a.request({url:j,method:"POST",data:d(i),onSuccess:function onSuccess(a){var d=c.querySelectorAll(g);if(d){var e=d[0];e.outerHTML=a,b.initManagement()}},onError:function onError(a){e("".concat(a.status," ").concat(a.statusText))}})})["catch"](function(a){e(a)})}},b.editLabel=function(b,f){var g=c.getElementById(f);if(!g)return!1;var h=atob(g.dataset.postback_url),i=b.parentElement.parentElement,j=i.dataset.credential_id,k=i.querySelectorAll("td"),l=k[0],m=k[1],n=m.querySelectorAll("button"),o=n[0],p=n[1],q=l.innerText,r=c.createElement("input");r.type="text",r.name="label",r.defaultValue=q;var s=c.createElement("button");s.className="btn btn-success btn-sm",s.innerText=a.JText._("PLG_SYSTEM_PASSWORDLESS_MANAGE_BTN_SAVE_LABEL"),s.addEventListener("click",function(){var b=r.value;if(""!==b){a.request({url:h,method:"POST",data:d({option:"com_ajax",group:"system",plugin:"passwordless",format:"json",encoding:"json",akaction:"savelabel",credential_id:j,new_label:b}),onSuccess:function onSuccess(b){var c=!1;try{c=JSON.parse(b)}catch(a){c="true"===b}!0!==c&&e(a.JText._("PLG_SYSTEM_PASSWORDLESS_ERR_LABEL_NOT_SAVED"))},onError:function onError(b){e("".concat(a.JText._("PLG_SYSTEM_PASSWORDLESS_ERR_LABEL_NOT_SAVED")," -- ").concat(b.status," ").concat(b.statusText))}})}return l.innerText=b,o.disabled=!1,p.disabled=!1,!1},!1);var t=c.createElement("button");return t.className="btn btn-danger btn-sm",t.innerText=a.JText._("PLG_SYSTEM_PASSWORDLESS_MANAGE_BTN_CANCEL_LABEL"),t.addEventListener("click",function(){return l.innerText=q,o.disabled=!1,p.disabled=!1,!1},!1),l.innerHTML="",l.appendChild(r),l.appendChild(s),l.appendChild(t),o.disabled=!0,p.disabled=!0,!1},b["delete"]=function(b,f){var g=c.getElementById(f);if(!g)return!1;var h=atob(g.dataset.postback_url),i=b.parentElement.parentElement,j=i.dataset.credential_id,k=i.querySelectorAll("td"),l=k[1],m=l.querySelectorAll("button"),n=m[0],o=m[1];n.disabled=!0,o.disabled=!0;return a.request({url:h,method:"POST",data:d({option:"com_ajax",group:"system",plugin:"passwordless",format:"json",encoding:"json",akaction:"delete",credential_id:j}),onSuccess:function onSuccess(b){var c=!1;try{c=JSON.parse(b)}catch(a){c="true"===b}return!0===c?void i.parentElement.removeChild(i):void e(a.JText._("PLG_SYSTEM_PASSWORDLESS_ERR_NOT_DELETED"))},onError:function onError(b){n.disabled=!1,o.disabled=!1,e("".concat(a.JText._("PLG_SYSTEM_PASSWORDLESS_ERR_NOT_DELETED")," -- ").concat(b.status," ").concat(b.statusText))}}),!1},b.addOnClick=function(a){return a.preventDefault(),b.createCredentials(a.currentTarget.getAttribute("data-random-id"),"#plg_system_passwordless-management-interface"),!1},b.editOnClick=function(a){return a.preventDefault(),b.editLabel(a.currentTarget,a.currentTarget.getAttribute("data-random-id")),!1},b.deleteOnClick=function(a){return a.preventDefault(),b["delete"](a.currentTarget,a.currentTarget.getAttribute("data-random-id")),!1},b.initManagement=function(){var a=c.getElementById("plg_system_passwordless-manage-add");a&&a.addEventListener("click",b.addOnClick);var d=[].slice.call(c.querySelectorAll(".plg_system_passwordless-manage-edit"));d.length&&d.forEach(function(a){a.addEventListener("click",b.editOnClick)});var e=[].slice.call(c.querySelectorAll(".plg_system_passwordless-manage-delete"));e.length&&e.forEach(function(a){a.addEventListener("click",b.deleteOnClick)})},b.initManagement()}(Joomla,window.akeeba.Passwordless,document);

//# sourceMappingURL=manage.min.js.map